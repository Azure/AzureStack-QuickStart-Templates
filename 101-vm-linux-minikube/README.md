# Minikube on AzureStack
This template deploys a Ubuntu 16.04 virtual machine on AzureStack running Minikube to manage kubenetes cluster.

## Prerequisites
Follow the below links to create/download an Ubuntu 16.04 LTS Image and upload the same to Azure Stack's Platform Image Repository(PIR)
1. https://azure.microsoft.com/en-us/documentation/articles/azure-stack-linux/
2. https://azure.microsoft.com/en-us/documentation/articles/azure-stack-add-image-pir/
	Note: please use the default values for linuxPublisher,linuxOffer,linuxSku,linuxVersion found in azuredeploy.json while creating the manifest.json in PIR

## Deploying from Portal

+	Login into Azurestack portal
+	Click "New" -> "Custom" -> "Template deployment -> "Edit Template" -> "Load File" -> Select azure.deploy.json from the local drive -> "Save"
+ Click "Edit Parameters" and 	Fill the parameters. Please note down the admin name and password for later use
+	Select "Create new" to create new Resource Group and give a new resource group name
+	Click "Create"
+ Wait until the template deployment is completed

## Deploying from PowerShell

Download azuredeploy.json and azuredeploy.azurestack.parameters.json to local machine 

Modify parameter value in azuredeploy.parameters.json as needed 

Allow cookies in IE: Open IE at c:\Program Files\Internet Explorer\iexplore.exe -> Internet Options -> Privacy -> Advanced -> Click OK -> Click OK again

Launch a PowerShell console

Change working folder to the folder containing this template

```PowerShell

# Add specific Azure Stack Environment 

$AadTenantId = <Tenant Id> #GUID Specific to the AAD Tenant 

Add-AzureRmEnvironment -Name 'Azure Stack' `
��� -ActiveDirectoryEndpoint ("https://login.windows.net/$AadTenantId/") `
��� -ActiveDirectoryServiceEndpointResourceId "https://azurestack.local-api/" `
��� -ResourceManagerEndpoint ("https://api.azurestack.local/") `
��� -GalleryEndpoint ("https://gallery.azurestack.local/") `
��� -GraphEndpoint "https://graph.windows.net/"

# Get Azure Stack Environment Information 
$env = Get-AzureRmEnvironment 'Azure Stack' 

# Authenticate to AAD with Azure Stack Environment 
Add-AzureRmAccount -Environment $env -Verbose 

# Get Azure Stack Environment Subscription 
$SubName = <Subscription Name> # The sbuscription name is the offer name by default 
Get-AzureRmSubscription -SubscriptionName $SubName | Select-AzureRmSubscription

#Resource group name. Please make sure the resource group does not exist 
$resourceGroupName = "minikubeResourceGroup"
$deploymentName = "minikubeDeployment"
$location = "Local" 
New-AzurermResourceGroup -Name $resourceGroupName -Location $location 

#Start new Deployment
New-AzurermResourceGroupDeployment -Name $deploymentName -ResourceGroupName $resourceGroupName `
��� -TemplateParameterFile .\azuredeploy.parameters.json -TemplateFile .\azuredeploy.json

```

## About Minikube
Minikube is a tool that makes it easy to run Kubernetes locally. Minikube runs a single-node Kubernetes cluster inside a VM on your laptop for users looking to try out Kubernetes or develop with it day-to-day.

Here is a brief overview of the minikube deployment on azurestack
![Image of Minikube architecture](https://github.com/vpatelsj/AzureStack-QuickStart-Templates/blob/master/101-vm-linux-minikube/images/minikubearch.png)

Minikube creates a simple kubernetes cluster that consists of one master node and one slave node. Additionally, Minikube packages and configures a linux VM, the contrainer runtime and all kubernetes components optimized for local development. Our template installs following components:

* Ubuntu 16.04 LTS VM
* Docker-CE from https://download.docker.com/linux/ubuntu 
* Kubectl from https://storage.googleapis.com/kubernetes-release/release/v1.8.0/bin/linux/amd64/kubectl
* Minikube from https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
* xFCE4 and xRDP

## Getting Started
+ This template deploys a linux virtual machine and generates a PublicIP resource so that users can RDP to it. 
  ![Image of Minikube ResourceGroup](https://github.com/vpatelsj/AzureStack-QuickStart-Templates/blob/master/101-vm-linux-minikube/images/ResourceGroup.PNG)

+ To find out the public IP of the virtual machine, open the resource group and click on the virtual machine of the Resource Group generated by the template.
  ![Image of Minikube Public IP](https://github.com/vpatelsj/AzureStack-QuickStart-Templates/blob/master/101-vm-linux-minikube/images/PublicIP.PNG)
  
+ Open Remote Desktop and connect to the virtual machine using the public IP. Enter the user name and password that were entered while creating the resource group.
  
  ![Image of Remote Desktop](https://github.com/vpatelsj/AzureStack-QuickStart-Templates/blob/master/101-vm-linux-minikube/images/RemoteDesktop.PNG) 
  ![Image of Remote Desktop Cred](https://github.com/vpatelsj/AzureStack-QuickStart-Templates/blob/master/101-vm-linux-minikube/images/RemoteDesktopCred.PNG)

+ Open Terminal and enter following command to start minikube
  ![Image of Terminal](https://github.com/vpatelsj/AzureStack-QuickStart-Templates/blob/master/101-vm-linux-minikube/images/terminal.PNG)
```
sudo minikube start --vm-driver=none
sudo minikube dashboard --url
```

+ Open browser and visit the url to see the kubernetes dashboard. Congratulations, you now have a fully working kubernetes installation using minikube.

## Deploying Applications
If you would like to deploy a sample application, please visit the official documentation page of kubernetes, skip the ```"Create Minikube Cluster"``` section as you have already created one above. Simply jump to the section ```"Create your Node.js application"```  at https://kubernetes.io/docs/tutorials/stateless-application/hello-minikube/

